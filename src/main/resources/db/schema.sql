DROP TABLE IF EXISTS PRODUCT;
DROP TABLE IF EXISTS DIARY_RECORD;
DROP TABLE IF EXISTS DIARY;

CREATE TABLE PRODUCT (
    PRODUCT_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    PRODUCT_NAME VARCHAR(255) NOT NULL,
    PRODUCT_CORP VARCHAR(255),
    PRODUCT_NORMALIZED_NAME VARCHAR(255) UNIQUE,
    NUTRITION_FACTS JSON,
    MEMBER_ID BIGINT NOT NULL,
    CREATED_AT DATETIME NOT NULL,
    UPDATED_AT DATETIME NOT NULL
);

CREATE TABLE DIARY (
    DIARY_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    MEMBER_ID BIGINT NOT NULL,
    DIARY_DATE DATE NOT NULL,
    CONSTRAINT UC_DIARY_DATE UNIQUE (MEMBER_ID, DIARY_DATE)
);

CREATE TABLE DIARY_RECORD (
    DIARY_RECORD_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    DIARY_ID BIGINT,
    PRODUCT_ID BIGINT NOT NULL,
    MEAL_TYPE VARCHAR(255) NOT NULL,
    QUANTITY DECIMAL NOT NULL,
    SERVING_UNIT VARCHAR(255) NOT NULL,
    CALCULATED_NUTRITION JSON,
    FOREIGN KEY (DIARY_ID) REFERENCES DIARY(DIARY_ID)
);


